const t=new class{constructor(t){console.log(t),this.score=0,this.status="idle",this.state=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}moveLeft(){if("playing"!==this.status)return;let t=this.state,e=structuredClone(this.state);function s(t){return t.filter(t=>0!==t)}for(let e=0;e<t.length;e++){let i=t[e].length;t[e]=s(t[e]);for(let i=0;i<t[e].length;i++)t[e][i]===t[e][i+1]&&(t[e][i]*=2,t[e][i+1]=0,this.score+=+t[e][i],t[e]=s(t[e]));for(let s=t[e].length;s<i;s++)t[e].push(0)}this.checkChangesState(e),this.updateUI()}moveRight(){if("playing"!==this.status)return;let t=this.state,e=structuredClone(this.state);function s(t){return t.filter(t=>0!==t)}for(let e=0;e<t.length;e++){let i=t[e].length;t[e]=s(t[e]);let l=!1;for(let i=t[e].length;i>0;i--){if(l){l=!1;continue}t[e][i]===t[e][i-1]&&(t[e][i]*=2,t[e][i-1]=0,this.score+=+t[e][i],t[e]=s(t[e]),l=!0)}for(let s=t[e].length;s<i;s++)t[e].unshift(0)}this.checkChangesState(e),this.updateUI()}moveUp(){if("playing"!==this.status)return;let t=this.state,e=structuredClone(this.state);function s(t){return t.filter(t=>0!==t)}this.transpose(t);for(let e=0;e<t.length;e++){let i=t[e].length;t[e]=s(t[e]);for(let i=0;i<t[e].length;i++)t[e][i]===t[e][i+1]&&(t[e][i]*=2,t[e][i+1]=0,this.score+=+t[e][i],t[e]=s(t[e]));for(let s=t[e].length;s<i;s++)t[e].push(0)}this.transpose(t),this.checkChangesState(e),this.updateUI()}moveDown(){if("playing"!==this.status)return;let t=this.state,e=structuredClone(this.state);function s(t){return t.filter(t=>0!==t)}this.transpose(t);for(let e=0;e<t.length;e++){let i=t[e].length;t[e]=s(t[e]);let l=!1;for(let i=t[e].length;i>0;i--){if(l){l=!1;continue}t[e][i]===t[e][i-1]&&(t[e][i]*=2,t[e][i-1]=0,this.score+=+t[e][i],t[e]=s(t[e]),l=!0)}for(let s=t[e].length;s<i;s++)t[e].unshift(0)}this.transpose(t),this.checkChangesState(e),this.updateUI()}getScore(){document.querySelector(".game-score").textContent=this.score}getState(){return this.state}getStatus(){"idle"===this.status?(document.querySelector(".message-start").classList.add("hidden"),this.status="playing"):"playing"===this.status?(document.querySelector(".message-lose").classList.add("hidden"),document.querySelector(".message-win").classList.add("hidden"),document.querySelector(".message-start").classList.remove("hidden"),this.status="idle"):"lose"===this.status?(document.querySelector(".message-lose").classList.remove("hidden"),this.status="playing"):"win"===this.status&&document.querySelector(".message-win").classList.remove("hidden")}start(){this.addRandomTile(),this.getStatus(),this.updateUI()}restart(){this.state=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,"win"===this.status&&(this.status="playing"),this.getStatus(),this.getScore(),this.updateUI()}addRandomTile(){let t=this.status;function e(s=!1){let i=Math.floor(4*Math.random());return s&&"playing"===t?(i=Math.random())<.9?2:4:s&&"idle"===t?0===(i=Math.floor(2*Math.random()))?2:4:i}function s(t){let s=!0;for(;s;){let i=e(),l=e();t[i][l]||(t[i][l]=e(!0),s=!1)}}0===this.state.flat().filter(t=>0!==t).length&&s(this.state),s(this.state)}checkChangesState(t){let e=t.flat().join(""),s=this.state.flat().join(""),i=this.state.flat().filter(t=>0!==t).length;if(e!==s)this.addRandomTile(!0);else if(16===i){let t=this.state,e=!1;for(let s=0;s<t.length;s++)for(let i=0;i<t.length;i++){let l=t[s][i];if(0===l){e=!0;break}(i+1<t.length&&l===t[s][i+1]||s+1<t.length&&l===t[s+1][i])&&(e=!0)}e||(this.status="lose",this.getStatus())}}updateUI(){let t=document.querySelectorAll(".field-cell");this.state.flat().some(t=>2048===t)&&(this.status="win",this.getStatus());for(let e=0;e<t.length;e++)this.state.flat()[e]?(t[e].textContent=this.state.flat()[e],t[e].classList=`field-cell field-cell--${t[e].textContent}`):(t[e].textContent="",t[e].classList="field-cell");this.getScore()}transpose(t){let e=t.length,s=t[0].length;for(let i=0;i<e;i++)for(let e=i+1;e<s;e++){let s=t[i][e];t[i][e]=t[e][i],t[e][i]=s}}},e=document.querySelector(".button");e.addEventListener("click",()=>{e.matches(".start")?(t.start(),e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart"):(t.restart(),e.classList.remove("restart"),e.classList.add("start"),e.textContent="Start")}),document.addEventListener("keydown",e=>{"ArrowLeft"===e.key&&t.moveLeft(),"ArrowRight"===e.key&&t.moveRight(),"ArrowUp"===e.key&&t.moveUp(),"ArrowDown"===e.key&&t.moveDown()});
//# sourceMappingURL=index.dbbbb16d.js.map
